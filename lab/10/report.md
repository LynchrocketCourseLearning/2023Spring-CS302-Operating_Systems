# OS Lab10 Report
name: 刘乐奇

sid: 12011327

Ubuntu用户名: lynchrocket

## 1. 请参照Sv32的地址转换过程，写出Sv39的转换过程
当在satp寄存器中启用了分页时，S模式和U模式的虚拟地址会以从根部遍历页表的方式转换为物理地址。
1. satp.PNN给出了一级页表的基址，VA[38:30]给出了一级页号，因此CPU会读取位于地址（satp.PPN\*4096+VA[38:30]\*4）的页表项。
2. 该PTE包含二级页表的基址，VA[29:21]给出了二级页号，，因此CPU会读取位于地址（satp.PPN\*4096+VA[29:21]\*4）的页表项。
3. 该PTE包含三级页表的基址，VA[20:12]给出了三级页号，，因此CPU会读取位于地址（satp.PPN\*4096+VA[20:12]\*4）的页表项。
4. 叶节点页表项的PPN字段和offset组成了最终结果，物理地址就是（LeafPTE.PPN\*4096+VA[11:0]）。

## 2. 一个巨页的大小是多少，如何计算得出巨页的大小？
如果第二级页表的页表项为叶节点页表项，则该页表项的[20:0]位将表示一个整体的偏移量，该页即为巨页。由其偏移量可知一个巨页的大小为
$$2^{20-0+1}bit=2^{18}byte=0.25MB$$

## 3. 一个4GB的内存空间使用下图所示的二级页表，页面大小为4KB，PTE大小为PTE_size。一个需要在高虚拟地址空间，中虚拟地址空间，和低虚拟地址空间分别使用4MB的连续空间的进程至少需要多大的页表空间？

要映射到`4MB`的连续物理空间（即 $2^{10}$ 个Page Frame），刚好需要有一个Page Table。高、中、低虚拟地址空间分别使用`4MB`的连续空间，则一共要3个Page Table。要容纳3个二级Page Table，只需一个一级Page Table。故总共需要 $4\times4KB=16KB$ 的页表空间。

## 4. `static inline void *page2kva(struct Page *page)` 的作用是什么?

输入一个physical page，获得映射到它的kernel virtual address。